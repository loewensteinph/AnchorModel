/*
Deployment script for Anchor

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Anchor"
:setvar DefaultFilePrefix "Anchor"
:setvar DefaultDataPath "H:\Program Files\Microsoft SQL Server\MSSQL13.SQL2016\MSSQL\DATA\"
:setvar DefaultLogPath "H:\Program Files\Microsoft SQL Server\MSSQL13.SQL2016\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF),
                MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = OFF,
                DELAYED_DURABILITY = DISABLED 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (QUERY_CAPTURE_MODE = ALL, FLUSH_INTERVAL_SECONDS = 900, INTERVAL_LENGTH_MINUTES = 60, MAX_PLANS_PER_QUERY = 200, CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 367), MAX_STORAGE_SIZE_MB = 100) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE = OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET MAXDOP = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET LEGACY_CARDINALITY_ESTIMATION = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET PARAMETER_SNIFFING = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET QUERY_OPTIMIZER_HOTFIXES = PRIMARY;
    END


GO
USE [$(DatabaseName)];


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [Anchor]...';


GO
CREATE ASSEMBLY [Anchor]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300E7B633540000000000000000E00002210B010800000600000006000000000000CE2500000020000000400000000040000020000000020000040000000000000004000000000000000080000000020000000000000300408500001000001000000000100000100000000000001000000000000000000000007C2500004F00000000400000A002000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000D4050000002000000006000000020000000000000000000000000000200000602E72737263000000A0020000004000000004000000080000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000C00000000000000000000000000004000004200000000000000000000000000000000B025000000000000480000000200050080200000FC040000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096026F0400000A2D16280500000A026F0600000A6F0700000A730800000A2A14280900000A2A1E02280A00000A2A000042534A4201000100000000000C00000076322E302E35303732370000000005006C00000048010000237E0000B40100009001000023537472696E6773000000004403000008000000235553004C0300001000000023475549440000005C030000A001000023426C6F620000000000000002000001471500000900000000FA01330016000001000000090000000200000002000000010000000A00000003000000010000000200000000000A0001000000000006002F0028000A00570042000A00610042000600A30083000600C30083000A000301E800060040012301060055014B010600670123010000000001000000000001000100010010001500000005000100010050200000000096006A000A000100762000000000861872001100020000000100780021007200150029007200110031007200110019001801550139004401590119005C015E01490075016301110072006A0111008101700109007200110020001B001A002E000B0077012E0013008001048000000000000000000000000000000000E100000002000000000000000000000001001F000000000002000000000000000000000001003600000000000000003C4D6F64756C653E00416E63686F722E646C6C005574696C6974696573006D73636F726C69620053797374656D004F626A6563740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C42696E6172790053716C427974657300486173684D4435002E63746F720062696E617279446174610053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500416E63686F72004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E417474726962757465006765745F49734E756C6C0053797374656D2E53656375726974792E43727970746F677261706879004D4435004372656174650053797374656D2E494F0053747265616D006765745F53747265616D0048617368416C676F726974686D00436F6D7075746548617368006F705F496D706C69636974000000000003200000000000C7641B1E7755B04A8FCCCA2F22950BF30008B77A5C561934E0890600011109120D0320000104200101088139010003005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D446174614163636573730000000003200002040000121D04200012210620011D051221052001011D0506000111091D050801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100A42500000000000000000000BE250000002000000000000000000000000000000000000000000000B0250000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500204000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000440200000000000000000000440234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004A4010000010053007400720069006E006700460069006C00650049006E0066006F0000008001000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E003000000038000B00010049006E007400650072006E0061006C004E0061006D006500000041006E00630068006F0072002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000040000B0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000041006E00630068006F0072002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000D03500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [dbo].[AC_Actor]...';


GO
CREATE TABLE [dbo].[AC_Actor] (
    [AC_ID]       INT IDENTITY (1, 1) NOT NULL,
    [Metadata_AC] INT NOT NULL,
    CONSTRAINT [pkAC_Actor] PRIMARY KEY CLUSTERED ([AC_ID] ASC)
);


GO
PRINT N'Creating [dbo].[AC_exclusive_AC_with_ONG_currently]...';


GO
CREATE TABLE [dbo].[AC_exclusive_AC_with_ONG_currently] (
    [AC_ID_exclusive]                              INT      NOT NULL,
    [AC_ID_with]                                   INT      NOT NULL,
    [ONG_ID_currently]                             TINYINT  NOT NULL,
    [AC_exclusive_AC_with_ONG_currently_ChangedAt] DATETIME NOT NULL,
    [Metadata_AC_exclusive_AC_with_ONG_currently]  INT      NOT NULL,
    CONSTRAINT [pkAC_exclusive_AC_with_ONG_currently] PRIMARY KEY CLUSTERED ([AC_ID_exclusive] ASC, [AC_ID_with] ASC, [ONG_ID_currently] ASC, [AC_exclusive_AC_with_ONG_currently_ChangedAt] DESC),
    CONSTRAINT [AC_exclusive_AC_with_ONG_currently_uqAC_exclusive] UNIQUE NONCLUSTERED ([AC_ID_exclusive] ASC, [AC_exclusive_AC_with_ONG_currently_ChangedAt] ASC),
    CONSTRAINT [AC_exclusive_AC_with_ONG_currently_uqAC_with] UNIQUE NONCLUSTERED ([AC_ID_with] ASC, [AC_exclusive_AC_with_ONG_currently_ChangedAt] ASC)
);


GO
PRINT N'Creating [dbo].[AC_GEN_Actor_Gender]...';


GO
CREATE TABLE [dbo].[AC_GEN_Actor_Gender] (
    [AC_GEN_AC_ID]    INT NOT NULL,
    [AC_GEN_GEN_ID]   BIT NOT NULL,
    [Metadata_AC_GEN] INT NOT NULL,
    CONSTRAINT [pkAC_GEN_Actor_Gender] PRIMARY KEY CLUSTERED ([AC_GEN_AC_ID] ASC)
);


GO
PRINT N'Creating [dbo].[AC_NAM_Actor_Name]...';


GO
CREATE TABLE [dbo].[AC_NAM_Actor_Name] (
    [AC_NAM_AC_ID]      INT          NOT NULL,
    [AC_NAM_Actor_Name] VARCHAR (42) NOT NULL,
    [AC_NAM_ChangedAt]  DATETIME     NOT NULL,
    [Metadata_AC_NAM]   INT          NOT NULL,
    CONSTRAINT [pkAC_NAM_Actor_Name] PRIMARY KEY CLUSTERED ([AC_NAM_AC_ID] ASC, [AC_NAM_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[AC_parent_AC_child_PAT_having]...';


GO
CREATE TABLE [dbo].[AC_parent_AC_child_PAT_having] (
    [AC_ID_parent]                            INT      NOT NULL,
    [AC_ID_child]                             INT      NOT NULL,
    [PAT_ID_having]                           TINYINT  NOT NULL,
    [AC_parent_AC_child_PAT_having_ChangedAt] DATETIME NOT NULL,
    [Metadata_AC_parent_AC_child_PAT_having]  INT      NOT NULL,
    CONSTRAINT [pkAC_parent_AC_child_PAT_having] PRIMARY KEY CLUSTERED ([AC_ID_parent] ASC, [AC_ID_child] ASC, [PAT_ID_having] ASC, [AC_parent_AC_child_PAT_having_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[AC_part_PR_in_RAT_got]...';


GO
CREATE TABLE [dbo].[AC_part_PR_in_RAT_got] (
    [AC_ID_part]                      INT      NOT NULL,
    [PR_ID_in]                        INT      NOT NULL,
    [RAT_ID_got]                      TINYINT  NOT NULL,
    [AC_part_PR_in_RAT_got_ChangedAt] DATETIME NOT NULL,
    [Metadata_AC_part_PR_in_RAT_got]  INT      NOT NULL,
    CONSTRAINT [pkAC_part_PR_in_RAT_got] PRIMARY KEY CLUSTERED ([AC_ID_part] ASC, [PR_ID_in] ASC, [AC_part_PR_in_RAT_got_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[AC_PLV_Actor_ProfessionalLevel]...';


GO
CREATE TABLE [dbo].[AC_PLV_Actor_ProfessionalLevel] (
    [AC_PLV_AC_ID]     INT      NOT NULL,
    [AC_PLV_PLV_ID]    TINYINT  NOT NULL,
    [AC_PLV_ChangedAt] DATETIME NOT NULL,
    [Metadata_AC_PLV]  INT      NOT NULL,
    CONSTRAINT [pkAC_PLV_Actor_ProfessionalLevel] PRIMARY KEY CLUSTERED ([AC_PLV_AC_ID] ASC, [AC_PLV_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[EV_Event]...';


GO
CREATE TABLE [dbo].[EV_Event] (
    [EV_ID]       INT IDENTITY (1, 1) NOT NULL,
    [Metadata_EV] INT NOT NULL,
    CONSTRAINT [pkEV_Event] PRIMARY KEY CLUSTERED ([EV_ID] ASC)
);


GO
PRINT N'Creating [dbo].[GEN_Gender]...';


GO
CREATE TABLE [dbo].[GEN_Gender] (
    [GEN_ID]       BIT          NOT NULL,
    [GEN_Gender]   VARCHAR (42) NOT NULL,
    [Metadata_GEN] INT          NOT NULL,
    CONSTRAINT [pkGEN_Gender] PRIMARY KEY CLUSTERED ([GEN_ID] ASC),
    CONSTRAINT [uqGEN_Gender] UNIQUE NONCLUSTERED ([GEN_Gender] ASC)
);


GO
PRINT N'Creating [dbo].[ONG_Ongoing]...';


GO
CREATE TABLE [dbo].[ONG_Ongoing] (
    [ONG_ID]       TINYINT     NOT NULL,
    [ONG_Ongoing]  VARCHAR (3) NOT NULL,
    [Metadata_ONG] INT         NOT NULL,
    CONSTRAINT [pkONG_Ongoing] PRIMARY KEY CLUSTERED ([ONG_ID] ASC),
    CONSTRAINT [uqONG_Ongoing] UNIQUE NONCLUSTERED ([ONG_Ongoing] ASC)
);


GO
PRINT N'Creating [dbo].[PAT_ParentalType]...';


GO
CREATE TABLE [dbo].[PAT_ParentalType] (
    [PAT_ID]           TINYINT      NOT NULL,
    [PAT_ParentalType] VARCHAR (42) NOT NULL,
    [Metadata_PAT]     INT          NOT NULL,
    CONSTRAINT [pkPAT_ParentalType] PRIMARY KEY CLUSTERED ([PAT_ID] ASC),
    CONSTRAINT [uqPAT_ParentalType] UNIQUE NONCLUSTERED ([PAT_ParentalType] ASC)
);


GO
PRINT N'Creating [dbo].[PE_at_PR_wasPlayed]...';


GO
CREATE TABLE [dbo].[PE_at_PR_wasPlayed] (
    [PE_ID_at]                    INT NOT NULL,
    [PR_ID_wasPlayed]             INT NOT NULL,
    [Metadata_PE_at_PR_wasPlayed] INT NOT NULL,
    CONSTRAINT [pkPE_at_PR_wasPlayed] PRIMARY KEY CLUSTERED ([PE_ID_at] ASC)
);


GO
PRINT N'Creating [dbo].[PE_AUD_Performance_Audience]...';


GO
CREATE TABLE [dbo].[PE_AUD_Performance_Audience] (
    [PE_AUD_PE_ID]                INT NOT NULL,
    [PE_AUD_Performance_Audience] INT NOT NULL,
    [Metadata_PE_AUD]             INT NOT NULL,
    CONSTRAINT [pkPE_AUD_Performance_Audience] PRIMARY KEY CLUSTERED ([PE_AUD_PE_ID] ASC)
);


GO
PRINT N'Creating [dbo].[PE_DAT_Performance_Date]...';


GO
CREATE TABLE [dbo].[PE_DAT_Performance_Date] (
    [PE_DAT_PE_ID]            INT      NOT NULL,
    [PE_DAT_Performance_Date] DATETIME NOT NULL,
    [Metadata_PE_DAT]         INT      NOT NULL,
    CONSTRAINT [pkPE_DAT_Performance_Date] PRIMARY KEY CLUSTERED ([PE_DAT_PE_ID] ASC)
);


GO
PRINT N'Creating [dbo].[PE_in_AC_wasCast]...';


GO
CREATE TABLE [dbo].[PE_in_AC_wasCast] (
    [PE_ID_in]                  INT NOT NULL,
    [AC_ID_wasCast]             INT NOT NULL,
    [Metadata_PE_in_AC_wasCast] INT NOT NULL,
    CONSTRAINT [pkPE_in_AC_wasCast] PRIMARY KEY CLUSTERED ([PE_ID_in] ASC, [AC_ID_wasCast] ASC)
);


GO
PRINT N'Creating [dbo].[PE_Performance]...';


GO
CREATE TABLE [dbo].[PE_Performance] (
    [PE_ID]       INT IDENTITY (1, 1) NOT NULL,
    [Metadata_PE] INT NOT NULL,
    CONSTRAINT [pkPE_Performance] PRIMARY KEY CLUSTERED ([PE_ID] ASC)
);


GO
PRINT N'Creating [dbo].[PE_subset_EV_of]...';


GO
CREATE TABLE [dbo].[PE_subset_EV_of] (
    [PE_ID_subset]             INT NOT NULL,
    [EV_ID_of]                 INT NOT NULL,
    [Metadata_PE_subset_EV_of] INT NOT NULL,
    CONSTRAINT [pkPE_subset_EV_of] PRIMARY KEY CLUSTERED ([PE_ID_subset] ASC, [EV_ID_of] ASC),
    CONSTRAINT [PE_subset_EV_of_uqEV_of] UNIQUE NONCLUSTERED ([EV_ID_of] ASC),
    CONSTRAINT [PE_subset_EV_of_uqPE_subset] UNIQUE NONCLUSTERED ([PE_ID_subset] ASC)
);


GO
PRINT N'Creating [dbo].[PE_wasHeld_ST_at]...';


GO
CREATE TABLE [dbo].[PE_wasHeld_ST_at] (
    [PE_ID_wasHeld]             INT NOT NULL,
    [ST_ID_at]                  INT NOT NULL,
    [Metadata_PE_wasHeld_ST_at] INT NOT NULL,
    CONSTRAINT [pkPE_wasHeld_ST_at] PRIMARY KEY CLUSTERED ([PE_ID_wasHeld] ASC)
);


GO
PRINT N'Creating [dbo].[PR_content_ST_location_PE_of]...';


GO
CREATE TABLE [dbo].[PR_content_ST_location_PE_of] (
    [PR_ID_content]                         INT NOT NULL,
    [ST_ID_location]                        INT NOT NULL,
    [PE_ID_of]                              INT NOT NULL,
    [Metadata_PR_content_ST_location_PE_of] INT NOT NULL,
    CONSTRAINT [pkPR_content_ST_location_PE_of] PRIMARY KEY CLUSTERED ([PE_ID_of] ASC)
);


GO
PRINT N'Creating [dbo].[PR_NAM_Program_Name]...';


GO
CREATE TABLE [dbo].[PR_NAM_Program_Name] (
    [PR_NAM_PR_ID]        INT          NOT NULL,
    [PR_NAM_Program_Name] VARCHAR (42) NOT NULL,
    [Metadata_PR_NAM]     INT          NOT NULL,
    CONSTRAINT [pkPR_NAM_Program_Name] PRIMARY KEY CLUSTERED ([PR_NAM_PR_ID] ASC)
);


GO
PRINT N'Creating [dbo].[PR_Program]...';


GO
CREATE TABLE [dbo].[PR_Program] (
    [PR_ID]       INT IDENTITY (1, 1) NOT NULL,
    [Metadata_PR] INT NOT NULL,
    CONSTRAINT [pkPR_Program] PRIMARY KEY CLUSTERED ([PR_ID] ASC)
);


GO
PRINT N'Creating [dbo].[RAT_Rating]...';


GO
CREATE TABLE [dbo].[RAT_Rating] (
    [RAT_ID]       TINYINT      NOT NULL,
    [RAT_Rating]   VARCHAR (42) NOT NULL,
    [Metadata_RAT] INT          NOT NULL,
    CONSTRAINT [pkRAT_Rating] PRIMARY KEY CLUSTERED ([RAT_ID] ASC),
    CONSTRAINT [uqRAT_Rating] UNIQUE NONCLUSTERED ([RAT_Rating] ASC)
);


GO
PRINT N'Creating [dbo].[ST_at_PR_isPlaying]...';


GO
CREATE TABLE [dbo].[ST_at_PR_isPlaying] (
    [ST_ID_at]                     INT      NOT NULL,
    [PR_ID_isPlaying]              INT      NOT NULL,
    [ST_at_PR_isPlaying_ChangedAt] DATETIME NOT NULL,
    [Metadata_ST_at_PR_isPlaying]  INT      NOT NULL,
    CONSTRAINT [pkST_at_PR_isPlaying] PRIMARY KEY CLUSTERED ([ST_ID_at] ASC, [PR_ID_isPlaying] ASC, [ST_at_PR_isPlaying_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[ST_AVG_Stage_Average]...';


GO
CREATE TABLE [dbo].[ST_AVG_Stage_Average] (
    [ST_AVG_ST_ID]     INT      NOT NULL,
    [ST_AVG_UTL_ID]    TINYINT  NOT NULL,
    [ST_AVG_ChangedAt] DATETIME NOT NULL,
    [Metadata_ST_AVG]  INT      NOT NULL,
    CONSTRAINT [pkST_AVG_Stage_Average] PRIMARY KEY CLUSTERED ([ST_AVG_ST_ID] ASC, [ST_AVG_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[ST_MIN_Stage_Minimum]...';


GO
CREATE TABLE [dbo].[ST_MIN_Stage_Minimum] (
    [ST_MIN_ST_ID]    INT     NOT NULL,
    [ST_MIN_UTL_ID]   TINYINT NOT NULL,
    [Metadata_ST_MIN] INT     NOT NULL,
    CONSTRAINT [pkST_MIN_Stage_Minimum] PRIMARY KEY CLUSTERED ([ST_MIN_ST_ID] ASC)
);


GO
PRINT N'Creating [dbo].[ST_NAM_Stage_Name]...';


GO
CREATE TABLE [dbo].[ST_NAM_Stage_Name] (
    [ST_NAM_ST_ID]      INT          NOT NULL,
    [ST_NAM_Stage_Name] VARCHAR (42) NOT NULL,
    [ST_NAM_ChangedAt]  DATETIME     NOT NULL,
    [Metadata_ST_NAM]   INT          NOT NULL,
    CONSTRAINT [pkST_NAM_Stage_Name] PRIMARY KEY CLUSTERED ([ST_NAM_ST_ID] ASC, [ST_NAM_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[ST_Stage]...';


GO
CREATE TABLE [dbo].[ST_Stage] (
    [ST_ID]       INT IDENTITY (1, 1) NOT NULL,
    [Metadata_ST] INT NOT NULL,
    CONSTRAINT [pkST_Stage] PRIMARY KEY CLUSTERED ([ST_ID] ASC)
);


GO
PRINT N'Creating [dbo].[UTL_Utilization]...';


GO
CREATE TABLE [dbo].[UTL_Utilization] (
    [UTL_ID]          TINYINT NOT NULL,
    [UTL_Utilization] TINYINT NOT NULL,
    [Metadata_UTL]    INT     NOT NULL,
    CONSTRAINT [pkUTL_Utilization] PRIMARY KEY CLUSTERED ([UTL_ID] ASC),
    CONSTRAINT [uqUTL_Utilization] UNIQUE NONCLUSTERED ([UTL_Utilization] ASC)
);


GO
PRINT N'Creating [dbo].[AC_exclusive_AC_with_ONG_currently_fkAC_exclusive]...';


GO
ALTER TABLE [dbo].[AC_exclusive_AC_with_ONG_currently]
    ADD CONSTRAINT [AC_exclusive_AC_with_ONG_currently_fkAC_exclusive] FOREIGN KEY ([AC_ID_exclusive]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[AC_exclusive_AC_with_ONG_currently_fkAC_with]...';


GO
ALTER TABLE [dbo].[AC_exclusive_AC_with_ONG_currently]
    ADD CONSTRAINT [AC_exclusive_AC_with_ONG_currently_fkAC_with] FOREIGN KEY ([AC_ID_with]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[AC_exclusive_AC_with_ONG_currently_fkONG_currently]...';


GO
ALTER TABLE [dbo].[AC_exclusive_AC_with_ONG_currently]
    ADD CONSTRAINT [AC_exclusive_AC_with_ONG_currently_fkONG_currently] FOREIGN KEY ([ONG_ID_currently]) REFERENCES [dbo].[ONG_Ongoing] ([ONG_ID]);


GO
PRINT N'Creating [dbo].[fk_A_AC_GEN_Actor_Gender]...';


GO
ALTER TABLE [dbo].[AC_GEN_Actor_Gender]
    ADD CONSTRAINT [fk_A_AC_GEN_Actor_Gender] FOREIGN KEY ([AC_GEN_AC_ID]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[fk_K_AC_GEN_Actor_Gender]...';


GO
ALTER TABLE [dbo].[AC_GEN_Actor_Gender]
    ADD CONSTRAINT [fk_K_AC_GEN_Actor_Gender] FOREIGN KEY ([AC_GEN_GEN_ID]) REFERENCES [dbo].[GEN_Gender] ([GEN_ID]);


GO
PRINT N'Creating [dbo].[fkAC_NAM_Actor_Name]...';


GO
ALTER TABLE [dbo].[AC_NAM_Actor_Name]
    ADD CONSTRAINT [fkAC_NAM_Actor_Name] FOREIGN KEY ([AC_NAM_AC_ID]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[AC_parent_AC_child_PAT_having_fkAC_child]...';


GO
ALTER TABLE [dbo].[AC_parent_AC_child_PAT_having]
    ADD CONSTRAINT [AC_parent_AC_child_PAT_having_fkAC_child] FOREIGN KEY ([AC_ID_child]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[AC_parent_AC_child_PAT_having_fkAC_parent]...';


GO
ALTER TABLE [dbo].[AC_parent_AC_child_PAT_having]
    ADD CONSTRAINT [AC_parent_AC_child_PAT_having_fkAC_parent] FOREIGN KEY ([AC_ID_parent]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[AC_parent_AC_child_PAT_having_fkPAT_having]...';


GO
ALTER TABLE [dbo].[AC_parent_AC_child_PAT_having]
    ADD CONSTRAINT [AC_parent_AC_child_PAT_having_fkPAT_having] FOREIGN KEY ([PAT_ID_having]) REFERENCES [dbo].[PAT_ParentalType] ([PAT_ID]);


GO
PRINT N'Creating [dbo].[AC_part_PR_in_RAT_got_fkAC_part]...';


GO
ALTER TABLE [dbo].[AC_part_PR_in_RAT_got]
    ADD CONSTRAINT [AC_part_PR_in_RAT_got_fkAC_part] FOREIGN KEY ([AC_ID_part]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[AC_part_PR_in_RAT_got_fkPR_in]...';


GO
ALTER TABLE [dbo].[AC_part_PR_in_RAT_got]
    ADD CONSTRAINT [AC_part_PR_in_RAT_got_fkPR_in] FOREIGN KEY ([PR_ID_in]) REFERENCES [dbo].[PR_Program] ([PR_ID]);


GO
PRINT N'Creating [dbo].[AC_part_PR_in_RAT_got_fkRAT_got]...';


GO
ALTER TABLE [dbo].[AC_part_PR_in_RAT_got]
    ADD CONSTRAINT [AC_part_PR_in_RAT_got_fkRAT_got] FOREIGN KEY ([RAT_ID_got]) REFERENCES [dbo].[RAT_Rating] ([RAT_ID]);


GO
PRINT N'Creating [dbo].[fk_A_AC_PLV_Actor_ProfessionalLevel]...';


GO
ALTER TABLE [dbo].[AC_PLV_Actor_ProfessionalLevel]
    ADD CONSTRAINT [fk_A_AC_PLV_Actor_ProfessionalLevel] FOREIGN KEY ([AC_PLV_AC_ID]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[PE_at_PR_wasPlayed_fkPE_at]...';


GO
ALTER TABLE [dbo].[PE_at_PR_wasPlayed]
    ADD CONSTRAINT [PE_at_PR_wasPlayed_fkPE_at] FOREIGN KEY ([PE_ID_at]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[PE_at_PR_wasPlayed_fkPR_wasPlayed]...';


GO
ALTER TABLE [dbo].[PE_at_PR_wasPlayed]
    ADD CONSTRAINT [PE_at_PR_wasPlayed_fkPR_wasPlayed] FOREIGN KEY ([PR_ID_wasPlayed]) REFERENCES [dbo].[PR_Program] ([PR_ID]);


GO
PRINT N'Creating [dbo].[fkPE_AUD_Performance_Audience]...';


GO
ALTER TABLE [dbo].[PE_AUD_Performance_Audience]
    ADD CONSTRAINT [fkPE_AUD_Performance_Audience] FOREIGN KEY ([PE_AUD_PE_ID]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[fkPE_DAT_Performance_Date]...';


GO
ALTER TABLE [dbo].[PE_DAT_Performance_Date]
    ADD CONSTRAINT [fkPE_DAT_Performance_Date] FOREIGN KEY ([PE_DAT_PE_ID]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[PE_in_AC_wasCast_fkAC_wasCast]...';


GO
ALTER TABLE [dbo].[PE_in_AC_wasCast]
    ADD CONSTRAINT [PE_in_AC_wasCast_fkAC_wasCast] FOREIGN KEY ([AC_ID_wasCast]) REFERENCES [dbo].[AC_Actor] ([AC_ID]);


GO
PRINT N'Creating [dbo].[PE_in_AC_wasCast_fkPE_in]...';


GO
ALTER TABLE [dbo].[PE_in_AC_wasCast]
    ADD CONSTRAINT [PE_in_AC_wasCast_fkPE_in] FOREIGN KEY ([PE_ID_in]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[PE_subset_EV_of_fkEV_of]...';


GO
ALTER TABLE [dbo].[PE_subset_EV_of]
    ADD CONSTRAINT [PE_subset_EV_of_fkEV_of] FOREIGN KEY ([EV_ID_of]) REFERENCES [dbo].[EV_Event] ([EV_ID]);


GO
PRINT N'Creating [dbo].[PE_subset_EV_of_fkPE_subset]...';


GO
ALTER TABLE [dbo].[PE_subset_EV_of]
    ADD CONSTRAINT [PE_subset_EV_of_fkPE_subset] FOREIGN KEY ([PE_ID_subset]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[PE_wasHeld_ST_at_fkPE_wasHeld]...';


GO
ALTER TABLE [dbo].[PE_wasHeld_ST_at]
    ADD CONSTRAINT [PE_wasHeld_ST_at_fkPE_wasHeld] FOREIGN KEY ([PE_ID_wasHeld]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[PE_wasHeld_ST_at_fkST_at]...';


GO
ALTER TABLE [dbo].[PE_wasHeld_ST_at]
    ADD CONSTRAINT [PE_wasHeld_ST_at_fkST_at] FOREIGN KEY ([ST_ID_at]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[PR_content_ST_location_PE_of_fkPE_of]...';


GO
ALTER TABLE [dbo].[PR_content_ST_location_PE_of]
    ADD CONSTRAINT [PR_content_ST_location_PE_of_fkPE_of] FOREIGN KEY ([PE_ID_of]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[PR_content_ST_location_PE_of_fkPR_content]...';


GO
ALTER TABLE [dbo].[PR_content_ST_location_PE_of]
    ADD CONSTRAINT [PR_content_ST_location_PE_of_fkPR_content] FOREIGN KEY ([PR_ID_content]) REFERENCES [dbo].[PR_Program] ([PR_ID]);


GO
PRINT N'Creating [dbo].[PR_content_ST_location_PE_of_fkST_location]...';


GO
ALTER TABLE [dbo].[PR_content_ST_location_PE_of]
    ADD CONSTRAINT [PR_content_ST_location_PE_of_fkST_location] FOREIGN KEY ([ST_ID_location]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[fkPR_NAM_Program_Name]...';


GO
ALTER TABLE [dbo].[PR_NAM_Program_Name]
    ADD CONSTRAINT [fkPR_NAM_Program_Name] FOREIGN KEY ([PR_NAM_PR_ID]) REFERENCES [dbo].[PR_Program] ([PR_ID]);


GO
PRINT N'Creating [dbo].[ST_at_PR_isPlaying_fkPR_isPlaying]...';


GO
ALTER TABLE [dbo].[ST_at_PR_isPlaying]
    ADD CONSTRAINT [ST_at_PR_isPlaying_fkPR_isPlaying] FOREIGN KEY ([PR_ID_isPlaying]) REFERENCES [dbo].[PR_Program] ([PR_ID]);


GO
PRINT N'Creating [dbo].[ST_at_PR_isPlaying_fkST_at]...';


GO
ALTER TABLE [dbo].[ST_at_PR_isPlaying]
    ADD CONSTRAINT [ST_at_PR_isPlaying_fkST_at] FOREIGN KEY ([ST_ID_at]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[fk_A_ST_AVG_Stage_Average]...';


GO
ALTER TABLE [dbo].[ST_AVG_Stage_Average]
    ADD CONSTRAINT [fk_A_ST_AVG_Stage_Average] FOREIGN KEY ([ST_AVG_ST_ID]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[fk_K_ST_AVG_Stage_Average]...';


GO
ALTER TABLE [dbo].[ST_AVG_Stage_Average]
    ADD CONSTRAINT [fk_K_ST_AVG_Stage_Average] FOREIGN KEY ([ST_AVG_UTL_ID]) REFERENCES [dbo].[UTL_Utilization] ([UTL_ID]);


GO
PRINT N'Creating [dbo].[fk_A_ST_MIN_Stage_Minimum]...';


GO
ALTER TABLE [dbo].[ST_MIN_Stage_Minimum]
    ADD CONSTRAINT [fk_A_ST_MIN_Stage_Minimum] FOREIGN KEY ([ST_MIN_ST_ID]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[fk_K_ST_MIN_Stage_Minimum]...';


GO
ALTER TABLE [dbo].[ST_MIN_Stage_Minimum]
    ADD CONSTRAINT [fk_K_ST_MIN_Stage_Minimum] FOREIGN KEY ([ST_MIN_UTL_ID]) REFERENCES [dbo].[UTL_Utilization] ([UTL_ID]);


GO
PRINT N'Creating [dbo].[fkST_NAM_Stage_Name]...';


GO
ALTER TABLE [dbo].[ST_NAM_Stage_Name]
    ADD CONSTRAINT [fkST_NAM_Stage_Name] FOREIGN KEY ([ST_NAM_ST_ID]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[MD5]...';


GO
CREATE FUNCTION [dbo].[MD5]
(@binaryData VARBINARY (MAX) NULL)
RETURNS VARBINARY (16)
AS
 EXTERNAL NAME [Anchor].[Utilities].[HashMD5]


GO
PRINT N'Creating [dbo].[PE_REV_Performance_Revenue]...';


GO
CREATE TABLE [dbo].[PE_REV_Performance_Revenue] (
    [PE_REV_PE_ID]               INT      NOT NULL,
    [PE_REV_Performance_Revenue] MONEY    NOT NULL,
    [PE_REV_ChangedAt]           DATETIME NOT NULL,
    [PE_REV_Checksum]            AS       CAST (dbo.MD5(CAST (PE_REV_Performance_Revenue AS VARBINARY (MAX))) AS VARBINARY (16)) PERSISTED,
    [Metadata_PE_REV]            INT      NOT NULL,
    CONSTRAINT [pkPE_REV_Performance_Revenue] PRIMARY KEY CLUSTERED ([PE_REV_PE_ID] ASC, [PE_REV_ChangedAt] DESC)
);


GO
PRINT N'Creating [dbo].[PLV_ProfessionalLevel]...';


GO
CREATE TABLE [dbo].[PLV_ProfessionalLevel] (
    [PLV_ID]                TINYINT       NOT NULL,
    [PLV_ProfessionalLevel] VARCHAR (MAX) NOT NULL,
    [PLV_Checksum]          AS            CAST (dbo.MD5(CAST (PLV_ProfessionalLevel AS VARBINARY (MAX))) AS VARBINARY (16)) PERSISTED,
    [Metadata_PLV]          INT           NOT NULL,
    CONSTRAINT [pkPLV_ProfessionalLevel] PRIMARY KEY CLUSTERED ([PLV_ID] ASC),
    CONSTRAINT [uqPLV_ProfessionalLevel] UNIQUE NONCLUSTERED ([PLV_Checksum] ASC)
);


GO
PRINT N'Creating [dbo].[ST_LOC_Stage_Location]...';


GO
CREATE TABLE [dbo].[ST_LOC_Stage_Location] (
    [ST_LOC_ST_ID]          INT               NOT NULL,
    [ST_LOC_Stage_Location] [sys].[geography] NOT NULL,
    [ST_LOC_Checksum]       AS                CAST (dbo.MD5(CAST (ST_LOC_Stage_Location AS VARBINARY (MAX))) AS VARBINARY (16)) PERSISTED,
    [Metadata_ST_LOC]       INT               NOT NULL,
    CONSTRAINT [pkST_LOC_Stage_Location] PRIMARY KEY CLUSTERED ([ST_LOC_ST_ID] ASC)
);


GO
PRINT N'Creating [dbo].[fk_K_AC_PLV_Actor_ProfessionalLevel]...';


GO
ALTER TABLE [dbo].[AC_PLV_Actor_ProfessionalLevel]
    ADD CONSTRAINT [fk_K_AC_PLV_Actor_ProfessionalLevel] FOREIGN KEY ([AC_PLV_PLV_ID]) REFERENCES [dbo].[PLV_ProfessionalLevel] ([PLV_ID]);


GO
PRINT N'Creating [dbo].[fkPE_REV_Performance_Revenue]...';


GO
ALTER TABLE [dbo].[PE_REV_Performance_Revenue]
    ADD CONSTRAINT [fkPE_REV_Performance_Revenue] FOREIGN KEY ([PE_REV_PE_ID]) REFERENCES [dbo].[PE_Performance] ([PE_ID]);


GO
PRINT N'Creating [dbo].[fkST_LOC_Stage_Location]...';


GO
ALTER TABLE [dbo].[ST_LOC_Stage_Location]
    ADD CONSTRAINT [fkST_LOC_Stage_Location] FOREIGN KEY ([ST_LOC_ST_ID]) REFERENCES [dbo].[ST_Stage] ([ST_ID]);


GO
PRINT N'Creating [dbo].[lAC_Actor]...';


GO
CREATE VIEW [dbo].[lAC_Actor] WITH SCHEMABINDING AS SELECT [AC].AC_ID,[AC].Metadata_AC,[NAM].AC_NAM_AC_ID,[NAM].Metadata_AC_NAM,[NAM].AC_NAM_ChangedAt,[NAM].AC_NAM_Actor_Name,  [GEN].AC_GEN_AC_ID,[GEN].Metadata_AC_GEN,[kGEN].GEN_Gender AS AC_GEN_GEN_Gender,[kGEN].Metadata_GEN AS AC_GEN_Metadata_GEN,[GEN].AC_GEN_GEN_ID , [PLV].AC_PLV_AC_ID,[PLV].Metadata_AC_PLV,[PLV].AC_PLV_ChangedAt,[kPLV].PLV_ProfessionalLevel AS AC_PLV_PLV_ProfessionalLevel,[kPLV].Metadata_PLV AS AC_PLV_Metadata_PLV,[PLV].AC_PLV_PLV_ID FROM [dbo].[AC_Actor] [AC] LEFT JOIN [dbo].[AC_NAM_Actor_Name] [NAM] ON [NAM].AC_NAM_AC_ID = [AC].AC_ID AND
    [NAM].AC_NAM_ChangedAt = (
        SELECT
            max(sub.AC_NAM_ChangedAt)
        FROM
            [dbo].[AC_NAM_Actor_Name] sub
        WHERE
            sub.AC_NAM_AC_ID = [AC].AC_ID
   ) LEFT JOIN [dbo].[AC_GEN_Actor_Gender] [GEN] ON [GEN].AC_GEN_AC_ID = [AC].AC_ID LEFT JOIN [dbo].[GEN_Gender] [kGEN] ON [kGEN].GEN_ID = [GEN].AC_GEN_GEN_ID LEFT JOIN [dbo].[AC_PLV_Actor_ProfessionalLevel] [PLV] ON [PLV].AC_PLV_AC_ID = [AC].AC_ID AND
    [PLV].AC_PLV_ChangedAt = (
        SELECT
            max(sub.AC_PLV_ChangedAt)
        FROM
            [dbo].[AC_PLV_Actor_ProfessionalLevel] sub
        WHERE
            sub.AC_PLV_AC_ID = [AC].AC_ID
   ) LEFT JOIN [dbo].[PLV_ProfessionalLevel] [kPLV] ON [kPLV].PLV_ID = [PLV].AC_PLV_PLV_ID
GO
PRINT N'Creating [dbo].[lPE_Performance]...';


GO
CREATE VIEW [dbo].[lPE_Performance] WITH SCHEMABINDING AS SELECT [PE].PE_ID,[PE].Metadata_PE,[DAT].PE_DAT_PE_ID,[DAT].Metadata_PE_DAT,[DAT].PE_DAT_Performance_Date,  [AUD].PE_AUD_PE_ID,[AUD].Metadata_PE_AUD,[AUD].PE_AUD_Performance_Audience,  [REV].PE_REV_PE_ID,[REV].Metadata_PE_REV,[REV].PE_REV_ChangedAt,[REV].PE_REV_Checksum,[REV].PE_REV_Performance_Revenue FROM [dbo].[PE_Performance] [PE] LEFT JOIN [dbo].[PE_DAT_Performance_Date] [DAT] ON [DAT].PE_DAT_PE_ID = [PE].PE_ID LEFT JOIN [dbo].[PE_AUD_Performance_Audience] [AUD] ON [AUD].PE_AUD_PE_ID = [PE].PE_ID LEFT JOIN [dbo].[PE_REV_Performance_Revenue] [REV] ON [REV].PE_REV_PE_ID = [PE].PE_ID AND
    [REV].PE_REV_ChangedAt = (
        SELECT
            max(sub.PE_REV_ChangedAt)
        FROM
            [dbo].[PE_REV_Performance_Revenue] sub
        WHERE
            sub.PE_REV_PE_ID = [PE].PE_ID
   )
GO
PRINT N'Creating [dbo].[lPR_Program]...';


GO
CREATE VIEW [dbo].[lPR_Program] WITH SCHEMABINDING AS SELECT [PR].PR_ID,[PR].Metadata_PR,[NAM].PR_NAM_PR_ID,[NAM].Metadata_PR_NAM,[NAM].PR_NAM_Program_Name FROM [dbo].[PR_Program] [PR] LEFT JOIN [dbo].[PR_NAM_Program_Name] [NAM] ON [NAM].PR_NAM_PR_ID = [PR].PR_ID
GO
PRINT N'Creating [dbo].[lST_Stage]...';


GO
CREATE VIEW [dbo].[lST_Stage] WITH SCHEMABINDING AS SELECT [ST].ST_ID,[ST].Metadata_ST,[NAM].ST_NAM_ST_ID,[NAM].Metadata_ST_NAM,[NAM].ST_NAM_ChangedAt,[NAM].ST_NAM_Stage_Name,  [LOC].ST_LOC_ST_ID,[LOC].Metadata_ST_LOC,[LOC].ST_LOC_Checksum,[LOC].ST_LOC_Stage_Location,  [AVG].ST_AVG_ST_ID,[AVG].Metadata_ST_AVG,[AVG].ST_AVG_ChangedAt,[kAVG].UTL_Utilization AS ST_AVG_UTL_Utilization,[kAVG].Metadata_UTL AS ST_AVG_Metadata_UTL,[AVG].ST_AVG_UTL_ID , [MIN].ST_MIN_ST_ID,[MIN].Metadata_ST_MIN,[kMIN].UTL_Utilization AS ST_MIN_UTL_Utilization,[kMIN].Metadata_UTL AS ST_MIN_Metadata_UTL,[MIN].ST_MIN_UTL_ID FROM [dbo].[ST_Stage] [ST] LEFT JOIN [dbo].[ST_NAM_Stage_Name] [NAM] ON [NAM].ST_NAM_ST_ID = [ST].ST_ID AND
    [NAM].ST_NAM_ChangedAt = (
        SELECT
            max(sub.ST_NAM_ChangedAt)
        FROM
            [dbo].[ST_NAM_Stage_Name] sub
        WHERE
            sub.ST_NAM_ST_ID = [ST].ST_ID
   ) LEFT JOIN [dbo].[ST_LOC_Stage_Location] [LOC] ON [LOC].ST_LOC_ST_ID = [ST].ST_ID LEFT JOIN [dbo].[ST_AVG_Stage_Average] [AVG] ON [AVG].ST_AVG_ST_ID = [ST].ST_ID AND
    [AVG].ST_AVG_ChangedAt = (
        SELECT
            max(sub.ST_AVG_ChangedAt)
        FROM
            [dbo].[ST_AVG_Stage_Average] sub
        WHERE
            sub.ST_AVG_ST_ID = [ST].ST_ID
   ) LEFT JOIN [dbo].[UTL_Utilization] [kAVG] ON [kAVG].UTL_ID = [AVG].ST_AVG_UTL_ID LEFT JOIN [dbo].[ST_MIN_Stage_Minimum] [MIN] ON [MIN].ST_MIN_ST_ID = [ST].ST_ID LEFT JOIN [dbo].[UTL_Utilization] [kMIN] ON [kMIN].UTL_ID = [MIN].ST_MIN_UTL_ID
GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
